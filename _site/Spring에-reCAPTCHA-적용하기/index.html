<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="Ohjongsung's Dev Story" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="Ohjongsung's Dev Story" /> <title> Spring에 Recaptcha 적용하기 - Ohjongsung's Dev Story </title> <link rel="alternate" href="http://localhost:4000/Spring%EC%97%90-reCAPTCHA-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/Spring%EC%97%90-reCAPTCHA-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0/" /> <meta name="description" content="개발 블로그입니다. @github." /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="Spring에 Recaptcha 적용하기 | Ohjongsung's Dev Story" /> <meta property="og:title" content="Spring에 Recaptcha 적용하기 | Ohjongsung's Dev Story" /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/Spring%EC%97%90-reCAPTCHA-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0/" /> <meta property="og:description" content="개발 블로그입니다. @github." /> <meta property="og:image" content="http://localhost:4000/assets/img/ogp.png" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="Spring에 Recaptcha 적용하기 | " /> <meta name="twitter:url" content="http://localhost:4000/Spring%EC%97%90-reCAPTCHA-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0/" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:description" content="개발 블로그입니다. @github." /> <meta name="twitter:image" content="http://localhost:4000/assets/img/ogp.png" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ohjongsung's Dev Story" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> </head> <body data-theme="light" class="notransition"> <script> const body = document.body; const data = body.getAttribute("data-theme"); const initTheme = (state) => { if (state === "dark") { body.setAttribute("data-theme", "dark"); } else if (state === "light") { body.removeAttribute("data-theme"); } else { localStorage.setItem("theme", data); } }; initTheme(localStorage.getItem("theme")); setTimeout(() => body.classList.remove("notransition"), 75); </script> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">home</a><a class="menu-link" href="/archive/">archive</a><a class="menu-link" href="https://github.com/ohjongsung" target="_blank" rel="noopener" >github</a ><a class="menu-link rss" href="/feed.xml"> <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 512 512" fill="#ED812E" > <title>RSS</title> <path d="M108.56,342.78a60.34,60.34,0,1,0,60.56,60.44A60.63,60.63,0,0,0,108.56,342.78Z" /> <path d="M48,186.67v86.55c52,0,101.94,15.39,138.67,52.11s52,86.56,52,138.67h86.66C325.33,312.44,199.67,186.67,48,186.67Z" /> <path d="M48,48v86.56c185.25,0,329.22,144.08,329.22,329.44H464C464,234.66,277.67,48,48,48Z" /> </svg> </a> </div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <h1 class="header-title" itemprop="headline">Spring에 Recaptcha 적용하기</h1> <div class="post-meta"> <time datetime="2017-07-11T00:00:00+09:00" itemprop="datePublished"> 2017-07-11 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">Ohjongsung's Dev Story</span> </span> <time hidden datetime="" itemprop="dateModified"> Jul 11, 2017 </time> <span hidden itemprop="publisher" itemtype="Person">Ohjongsung's Dev Story</span> <span hidden itemprop="image"></span> <span hidden itemprop="mainEntityOfPage"><p>CAPTCHA(Completely Automated Public Turing test to tell Computers and Humans Apart, 완전 자동화된 사람과 컴퓨터 판별,캡차)는 HIP(Human Interaction Proof) 기술의 일종으로, 어떠한 사용자가 실제 사람인지 컴퓨터 프로그램인지를 구별하기 위해 사용되는 방법이다. 흔히 웹사이트 회원가입을 할 때 뜨는 자동가입방지 프로그램 같은 곳에 쓰인다.</p> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <p>CAPTCHA(Completely Automated Public Turing test to tell Computers and Humans Apart, 완전 자동화된 사람과 컴퓨터 판별,캡차)는 HIP(Human Interaction Proof) 기술의 일종으로, 어떠한 사용자가 실제 사람인지 컴퓨터 프로그램인지를 구별하기 위해 사용되는 방법이다. 흔히 웹사이트 회원가입을 할 때 뜨는 자동가입방지 프로그램 같은 곳에 쓰인다.</p> <h2 id="recaptcha-적용하기"> <a href="#recaptcha-적용하기" class="anchor-head"></a> reCAPTCHA 적용하기 </h2> <p>Spring에 reCAPTCHA를 적용해보자.</p> <h2 id="google-recaptcha에-사이트-등록"> <a href="#google-recaptcha에-사이트-등록" class="anchor-head"></a> Google reCAPTCHA에 사이트 등록 </h2> <p>reCAPTCHA를 사용하기 위해서는 먼저 <a href="https://www.google.com/recaptcha/admin">https://www.google.com/recaptcha/admin</a>에서 자신의 사이트를 등록 해야한다. 등록을 하면 site-key와 secret-key를 받는데, 이를 가지고 Google reCAPTCHA API를 사용하게 된다.</p> <h2 id="api-key-pair-설정"> <a href="#api-key-pair-설정" class="anchor-head"></a> API key-pair 설정 </h2> <p>site-key와 secret-key를 properties 파일에 써놓고 사용한다.</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>google.recaptcha.key.site=6LfaHiITAAAA...
google.recaptcha.key.secret=6LfaHiITAAAA...
</code></pre></div></div> <h2 id="recaptcha-관련-script와-html을-view에-작성"> <a href="#recaptcha-관련-script와-html을-view에-작성" class="anchor-head"></a> reCAPTCHA 관련 script와 html을 view에 작성 </h2> <p>reCAPTCHA를 사용하려는 화면 상단에 아래의 스크립트를 등록한다.</p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">text/javascript</span><span class="dl">"</span><span class="o">&gt;</span>
        <span class="kd">var</span> <span class="nx">onloadCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">grecaptcha</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="dl">'</span><span class="s1">g-recaptcha</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
                <span class="dl">'</span><span class="s1">sitekey</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">&lt;c:out value="${recaptchaSiteKey}" /&gt;</span><span class="dl">'</span><span class="p">,</span>
                <span class="dl">'</span><span class="s1">callback</span><span class="dl">'</span> <span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">recaptchaResponse</span><span class="dl">'</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">response</span><span class="p">;</span>
                <span class="p">},</span>
                <span class="dl">'</span><span class="s1">theme</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">light</span><span class="dl">'</span>
            <span class="p">});</span>
        <span class="p">}</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="dl">"</span><span class="s2">https://www.google.com/recaptcha/api.js?onload=onloadCallback&amp;render=explicit</span><span class="dl">"</span> <span class="k">async</span> <span class="nx">defer</span><span class="o">&gt;&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span></code></pre></div></div> <p>화면의 form Tag 안에 아래의 Element를 추가한다.</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"g-recaptcha"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;form:hidden</span> <span class="na">path=</span><span class="s">"recaptchaResponse"</span><span class="nt">/&gt;</span>
</code></pre></div></div> <ul> <li> <p>클라이언트 API의 로드는 script 태그 안에 정의되어 있다. 로드 될 때, onload 파라미터 덕분에 onloadCallback 메서드를 호출한다. 그리고 &amp;render=explicit는 reCAPTCHA 위젯의 렌더링을 클라이언트(브라우저)에 맡기는 거라고 보면 된다.</p> </li> <li> <p>실제 렌더링은 onloadCallback에서 시작된다. grecaptcha.render를 호출하면 위젯이 id=”g-recaptcha”를 가지는 div에 그려진다. 이때, sitekey를 파라미터로 전달한다.</p> </li> <li> <p>grecaptcha.reder에는 콜백함수가 정의되어 있다. 이는 사용자가 i’m not a robot 체크박스를 클릭하면, 응답 토큰을 받게 된다. 응답 토큰은 히든 폼 필드인 recaptchaResponse에 값이 저장되고, form submit 에 값이 담겨간다. 이제 recaptchaResponse의 토큰 값을 가지고 서버에서 유효성 검사를 하면 된다.</p> </li> </ul> <h2 id="서버에서-유효성-검사"> <a href="#서버에서-유효성-검사" class="anchor-head"></a> 서버에서 유효성 검사 </h2> <p>서버단에서 https://www.google.com/recaptcha/api/siteverify URL로 쿼리 매개 변수 secret, response 및 remoteip를 담아 HTTP 요청을 하면, 아래의 형태로 json 응답을 받는다.</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="err">|</span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"challenge_ts"</span><span class="p">:</span><span class="w"> </span><span class="err">timestamp</span><span class="p">,</span><span class="w">
    </span><span class="nl">"hostname"</span><span class="p">:</span><span class="w"> </span><span class="err">string</span><span class="p">,</span><span class="w">
    </span><span class="nl">"error-codes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <h4 id="form-submit을-처리하는-registrationcontroller"> <a href="#form-submit을-처리하는-registrationcontroller" class="anchor-head"></a> form submit을 처리하는 RegistrationController </h4> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RegistrationController</span> <span class="o">{</span>
 
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">ICaptchaService</span> <span class="n">captchaService</span><span class="o">;</span> 

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/user/registration"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">registerUserAccount</span><span class="o">(</span><span class="nd">@Valid</span> <span class="nc">UserDto</span> <span class="n">accountDto</span><span class="o">,</span> <span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">response</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"g-recaptcha-response"</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">captchaService</span><span class="o">.</span><span class="na">processResponse</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>
 
        <span class="c1">// Rest of implementation</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h4 id="유효성-검사를-위한-captchaservice"> <a href="#유효성-검사를-위한-captchaservice" class="anchor-head"></a> 유효성 검사를 위한 CaptchaService </h4> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CaptchaService</span> <span class="kd">implements</span> <span class="nc">ICaptchaService</span> <span class="o">{</span>
 
    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${google.recaptcha.key.secret}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">secret</span><span class="o">;</span>
 
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">RestOperations</span> <span class="n">restTemplate</span><span class="o">;</span>
 
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Pattern</span> <span class="no">RESPONSE_PATTERN</span> <span class="o">=</span> <span class="nc">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="s">"[A-Za-z0-9_-]+"</span><span class="o">);</span>
 
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">processResponse</span><span class="o">(</span><span class="nc">String</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">responseSanityCheck</span><span class="o">(</span><span class="n">response</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="s">"Response contains invalid characters"</span><span class="o">;</span>
        <span class="o">}</span>
 
        <span class="no">URI</span> <span class="n">verifyUri</span> <span class="o">=</span> <span class="no">URI</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
          <span class="s">"https://www.google.com/recaptcha/api/siteverify?secret=%s&amp;response=%s&amp;remoteip=%s"</span><span class="o">,</span>
          <span class="n">secret</span><span class="o">,</span> <span class="n">response</span><span class="o">,</span> <span class="n">getClientIP</span><span class="o">()));</span>
 
        <span class="nc">GoogleResponse</span> <span class="n">googleResponse</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="o">.</span><span class="na">getForObject</span><span class="o">(</span><span class="n">verifyUri</span><span class="o">,</span> <span class="nc">GoogleResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
 
        <span class="k">if</span><span class="o">(!</span><span class="n">googleResponse</span><span class="o">.</span><span class="na">isSuccess</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="s">"reCaptcha was not successfully validated"</span><span class="o">;</span>
        <span class="o">}</span>
        
        <span class="k">return</span> <span class="s">"success"</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">responseSanityCheck</span><span class="o">(</span><span class="nc">String</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">StringUtils</span><span class="o">.</span><span class="na">hasLength</span><span class="o">(</span><span class="n">response</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="no">RESPONSE_PATTERN</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">response</span><span class="o">).</span><span class="na">matches</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="nf">getClientIP</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="nc">String</span> <span class="n">xfHeader</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"X-Forwarded-For"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">xfHeader</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="na">getRemoteAddr</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">xfHeader</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">","</span><span class="o">)[</span><span class="mi">0</span><span class="o">];</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <ul> <li>processResponse 메소드의 return 타입을 String으로 해놨는데, 좋은 방법이 아니다. 참고한 github 소스에는 Exception throw로 되어 있는데, $.post 로 form submit 하는 것을 가정하고 작성된 것이다. 그래서 내 경우와는 맞지 않고 설명하자니 주제에 어긋나는 내용이 너무 길어져서 유효성 검사 후 결과에 대한 처리는 각자 상황에 맞게 알아서 하는 걸로 생략한다.</li> </ul> <h4 id="json-응답-클래스-googleresponse"> <a href="#json-응답-클래스-googleresponse" class="anchor-head"></a> json 응답 클래스 GoogleResponse </h4> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@JsonInclude</span><span class="o">(</span><span class="nc">JsonInclude</span><span class="o">.</span><span class="na">Include</span><span class="o">.</span><span class="na">NON_NULL</span><span class="o">)</span>
<span class="nd">@JsonIgnoreProperties</span><span class="o">(</span><span class="n">ignoreUnknown</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="nd">@JsonPropertyOrder</span><span class="o">({</span>
    <span class="s">"success"</span><span class="o">,</span>
    <span class="s">"challenge_ts"</span><span class="o">,</span>
    <span class="s">"hostname"</span><span class="o">,</span>
    <span class="s">"error-codes"</span>
<span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GoogleResponse</span> <span class="o">{</span>
 
    <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">"success"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">success</span><span class="o">;</span>
     
    <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">"challenge_ts"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">challengeTs</span><span class="o">;</span>
     
    <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">"hostname"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">hostname</span><span class="o">;</span>
     
    <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">"error-codes"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">ErrorCode</span><span class="o">[]</span> <span class="n">errorCodes</span><span class="o">;</span>
 
    <span class="nd">@JsonIgnore</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasClientError</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">ErrorCode</span><span class="o">[]</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">getErrorCodes</span><span class="o">();</span>
        <span class="k">if</span><span class="o">(</span><span class="n">errors</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">for</span><span class="o">(</span><span class="nc">ErrorCode</span> <span class="n">error</span> <span class="o">:</span> <span class="n">errors</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">switch</span><span class="o">(</span><span class="n">error</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">case</span> <span class="nl">InvalidResponse:</span>
                <span class="k">case</span> <span class="nl">MissingResponse:</span>
                    <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
 
    <span class="kd">static</span> <span class="kd">enum</span> <span class="nc">ErrorCode</span> <span class="o">{</span>
        <span class="nc">MissingSecret</span><span class="o">,</span>     <span class="nc">InvalidSecret</span><span class="o">,</span>
        <span class="nc">MissingResponse</span><span class="o">,</span>   <span class="nc">InvalidResponse</span><span class="o">;</span>
 
        <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">ErrorCode</span><span class="o">&gt;</span> <span class="n">errorsMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">ErrorCode</span><span class="o">&gt;(</span><span class="mi">4</span><span class="o">);</span>
 
        <span class="kd">static</span> <span class="o">{</span>
            <span class="n">errorsMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"missing-input-secret"</span><span class="o">,</span>   <span class="nc">MissingSecret</span><span class="o">);</span>
            <span class="n">errorsMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"invalid-input-secret"</span><span class="o">,</span>   <span class="nc">InvalidSecret</span><span class="o">);</span>
            <span class="n">errorsMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"missing-input-response"</span><span class="o">,</span> <span class="nc">MissingResponse</span><span class="o">);</span>
            <span class="n">errorsMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"invalid-input-response"</span><span class="o">,</span> <span class="nc">InvalidResponse</span><span class="o">);</span>
        <span class="o">}</span>
 
        <span class="nd">@JsonCreator</span>
        <span class="kd">public</span> <span class="kd">static</span> <span class="nc">ErrorCode</span> <span class="nf">forValue</span><span class="o">(</span><span class="nc">String</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">errorsMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
     
    <span class="c1">// standard getters and setters</span>
<span class="o">}</span>
</code></pre></div></div> <ul> <li>success 값이 true면 사용자가 사람임을 확인한 것이다. false면 errorCodes에 실패한 이유가 담겨오는데, 이것이 사용자의 잘못인지(InvalidResponse, MissingResponse) 서버 검증 로직의 잘못(MissingSecret, MissingResponse)인지 hasClientError 메소드로 판단한다.</li> </ul> <h2 id="reference"> <a href="#reference" class="anchor-head"></a> Reference </h2> <ul> <li><a href="https://github.com/Baeldung/spring-security-registration">https://github.com/Baeldung/spring-security-registration</a></li> <li><a href="https://kielczewski.eu/2015/07/spring-recaptcha-v2-form-validation/">https://kielczewski.eu/2015/07/spring-recaptcha-v2-form-validation/</a></li> <li><a href="http://www.nomadism.co.kr/19">http://www.nomadism.co.kr/19</a></li> <li><a href="http://ohgyun.com/590">http://ohgyun.com/590</a></li> <li><a href="https://ko.wikipedia.org/wiki/CAPTCHA">https://ko.wikipedia.org/wiki/CAPTCHA</a></li> </ul> </div> </article> </main> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/sitemap.xml-for-SEO/" > <div class="nav-arrow">Previous</div> <span class="post-title">Sitemap.xml For Seo</span> </a> <a class="post-nav-item post-nav-next" href="/Content-Delivery-Network%EC%9D%98-%EC%9E%A5%EC%A0%90%EA%B3%BC-%EB%8B%A8%EC%A0%90/"> <div class="nav-arrow">Next</div> <span class="post-title">Content Delivery Network의 장점과 단점</span> </a> </nav> <footer class="footer"> <!--<a class="footer_item" href="/thanks">ack.</a> <a class="footer_item" href="javascript::void(0)">resume</a>--> <a class="footer_item" href="/feed.xml">rss</a> <span class="footer_item">&copy; 2022</span> <small class="footer_copyright"> <!-- Klisé Theme: https://github.com/piharpi/jekyll-klise --> <a href="https://github.com/piharpi/jekyll-klise" target="_blank" rel="noreferrer noopener" >klisé</a > theme on <a href="https://jekyllrb.com" target="_blank" rel="noreferrer noopener" >jekyll</a > </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
